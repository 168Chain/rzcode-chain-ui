import{d as N,e as n,o as C,g as S,w as e,b as t,a as f,c as X,F as Q,i as Y,r as w,h as E,f as R,t as O,m as K}from"./index-LYaT0LI5.js";import{C as tt}from"./index-Jy13Qc5V.js";const et=f("span",{style:{"font-size":"18px",color:"#fab301"}},"区块",-1),at=f("span",null,"#",-1),st={class:"rows"},lt={class:"rows"},nt=N({__name:"index",props:{block:{}},setup(W){const h={emptyText:"暂无转账记录!"},B=[{title:"fm",dataIndex:"fm",key:"fm"},{title:"to",dataIndex:"to",key:"to"},{title:"amt",dataIndex:"amt",key:"amt"}];return(o,m)=>{const b=n("a-input-number"),v=n("a-form-item"),_=n("a-input"),c=n("a-input-group"),T=n("a-table"),z=n("a-textarea"),U=n("a-form"),g=n("a-card");return C(),S(g,{class:"block-card-container"},{title:e(()=>[et]),default:e(()=>[t(U,{labelCol:{span:4},wrapperCol:{span:20},class:"r-form"},{default:e(()=>[t(v,{label:"高度"},{default:e(()=>[t(b,{value:o.block.height,"onUpdate:value":m[0]||(m[0]=d=>o.block.height=d),style:{width:"100%"},min:"1"},{addonBefore:e(()=>[at]),_:1},8,["value"])]),_:1}),t(v,{label:"随机数"},{default:e(()=>[t(b,{value:o.block.nonce,"onUpdate:value":m[1]||(m[1]=d=>o.block.nonce=d),min:"1",max:"500000",style:{width:"100%"}},null,8,["value"])]),_:1}),t(v,{label:"币基"},{default:e(()=>[f("div",st,[t(c,{compact:""},{default:e(()=>[t(_,{addonBefore:"Bells",value:o.block.award,"onUpdate:value":m[2]||(m[2]=d=>o.block.award=d),style:{width:"50%"}},null,8,["value"]),t(_,{style:{width:"15%"},value:"->",disabled:""}),t(_,{style:{width:"30%"},value:o.block.miner,"onUpdate:value":m[3]||(m[3]=d=>o.block.miner=d)},null,8,["value"])]),_:1})])]),_:1}),t(v,{label:"TX",class:"tx"},{default:e(()=>[f("div",lt,[t(T,{bordered:"",columns:B,"data-source":o.block.txs,locale:h,size:"small",pagination:!1},null,8,["data-source"])])]),_:1}),t(v,{label:"前指针"},{default:e(()=>[t(z,{row:2,disabled:"",value:o.block.previous,"onUpdate:value":m[4]||(m[4]=d=>o.block.previous=d),style:{"font-size":"12px"}},null,8,["value"])]),_:1}),t(v,{label:"哈希"},{default:e(()=>[t(z,{row:2,disabled:"",value:o.block.hash,"onUpdate:value":m[5]||(m[5]=d=>o.block.hash=d),style:{"font-size":"12px"}},null,8,["value"])]),_:1})]),_:1})]),_:1})}}}),ot={class:"blockchain-container"},M=N({__name:"index",props:{blocks:{}},setup(W){return(h,B)=>(C(),X("div",ot,[(C(!0),X(Q,null,Y(h.blocks,o=>(C(),S(nt,{key:o.height,block:o,class:"block-card"},null,8,["block"]))),128))]))}}),it=f("span",{class:"title"},"配置",-1),ut={class:"rows"},rt=N({__name:"index",setup(W,{expose:h,emit:B}){const o=[{value:"1",label:"4核GPU"},{value:"2",label:"8核GPU"},{value:"3",label:"16核GPU"}],m=w(50),b=w("1"),v=w("2"),_=w("3"),c=E([]),T={emptyText:"暂无转账记录!"},z=()=>{b.value="1",v.value="2",_.value="3"},U=[{title:"fm",dataIndex:"fm",key:"fm"},{title:"to",dataIndex:"to",key:"to"},{title:"amt",dataIndex:"amt",key:"amt"}],g=w(!1),d=()=>g.value=!0,q=B,P=$=>{let l="";$==="a"&&(l=b.value),$==="b"&&(l=v.value),$==="c"&&(l=_.value),q("fetch-gpu",{machine:$,gpu:l})},y=w({fm:"",to:"",amt:0}),H=()=>{c.push(y.value),q("fetch-tx",c),A(),g.value=!1},J=()=>(g.value=!1,A()),A=()=>{y.value={fm:"",to:"",amt:0}};return h({reset:z}),($,l)=>{const j=n("a-button"),G=n("a-select"),x=n("a-form-item"),I=n("a-col"),F=n("a-row"),V=n("a-input-number"),s=n("a-table"),a=n("a-form"),u=n("a-input"),i=n("a-modal"),k=n("a-card");return C(),S(k,{class:"pool-cfg-card"},{title:e(()=>[it]),extra:e(()=>[t(j,{plain:"",onClick:d,danger:""},{default:e(()=>[R("转账")]),_:1})]),default:e(()=>[t(a,{ref:"formRef"},{default:e(()=>[t(F,{justify:"space-between"},{default:e(()=>[t(I,{span:7},{default:e(()=>[t(x,{label:"电脑A"},{default:e(()=>[t(G,{value:b.value,"onUpdate:value":l[0]||(l[0]=p=>b.value=p),options:o,onChange:l[1]||(l[1]=()=>P("a"))},null,8,["value"])]),_:1})]),_:1}),t(I,{span:7},{default:e(()=>[t(x,{label:"电脑B"},{default:e(()=>[t(G,{value:v.value,"onUpdate:value":l[2]||(l[2]=p=>v.value=p),options:o,onChange:l[3]||(l[3]=()=>P("b"))},null,8,["value"])]),_:1})]),_:1}),t(I,{span:7},{default:e(()=>[t(x,{label:"电脑C"},{default:e(()=>[t(G,{value:_.value,"onUpdate:value":l[4]||(l[4]=p=>_.value=p),options:o,onChange:l[5]||(l[5]=()=>P("c"))},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(F,{justify:"space-between"},{default:e(()=>[t(I,{span:11},{default:e(()=>[t(x,{label:"奖励"},{default:e(()=>[t(V,{addonAfter:"Bells",value:m.value,"onUpdate:value":l[6]||(l[6]=p=>m.value=p),onChange:l[7]||(l[7]=()=>P("a")),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(x,{label:"TX",class:"tx"},{default:e(()=>[f("div",ut,[t(s,{bordered:"",columns:U,"data-source":c,locale:T,size:"small",pagination:!1},null,8,["data-source"])])]),_:1})]),_:1},512),t(i,{ref:"xModal",open:g.value,"onUpdate:open":l[11]||(l[11]=p=>g.value=p),title:"开始转账","ok-text":"确认","cancel-text":"取消",width:"400px",closeIcon:!0,zIndex:"100",onOk:H,onCancel:J},{default:e(()=>[t(a,{labelCol:{span:5},wrapperCol:{span:19},model:y.value},{default:e(()=>[t(x,{label:"fm",name:"fm",rules:[{required:!0,message:"please input from address!"}]},{default:e(()=>[t(u,{value:y.value.fm,"onUpdate:value":l[8]||(l[8]=p=>y.value.fm=p),placeholder:"please input from address!"},null,8,["value"])]),_:1}),t(x,{label:"to",name:"to",rules:[{required:!0,message:"please input to address!"}]},{default:e(()=>[t(u,{value:y.value.to,"onUpdate:value":l[9]||(l[9]=p=>y.value.to=p),placeholder:"please input to address!"},null,8,["value"])]),_:1}),t(x,{label:"amt",name:"amt",rules:[{required:!0,message:"please input amount!"}]},{default:e(()=>[t(V,{addonAfter:"Bells",value:y.value.amt,"onUpdate:value":l[10]||(l[10]=p=>y.value.amt=p),style:{width:"100%"},min:"0",placeholder:"please input amount!"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})}}}),ct=f("span",{style:{"font-size":"18px",color:"#f14545"}},"电脑",-1),pt={class:"meta"},mt=N({__name:"index",props:{items:{}},setup(W){return(h,B)=>{const o=n("a-list-item-meta"),m=n("a-steps"),b=n("a-list-item"),v=n("a-list"),_=n("a-card");return C(),S(_,{class:"workflow-card"},{title:e(()=>[ct]),default:e(()=>[t(v,{class:"list"},{default:e(()=>[(C(!0),X(Q,null,Y(h.items,(c,T)=>(C(),S(b,{key:T,style:{"min-height":"87px"}},{default:e(()=>[t(o,null,{avatar:e(()=>[f("span",pt,O(c.title),1)]),_:2},1024),(C(),S(m,{items:c.steps,class:"steps",key:T},null,8,["items"]))]),_:2},1024))),128))]),_:1})]),_:1})}}}),dt={class:"diste-container"},_t=f("span",{style:{"font-size":"18px",color:"#f14545"}},"公链",-1),ft={style:{"margin-right":"300px",color:"#0AD8A7"}},vt={style:{"margin-right":"300px",color:"#fab301"}},wt={style:{"margin-right":"300px",color:"#404040"}},bt=f("span",null,"  ",-1),ht=f("span",{class:"meta"},"电脑A",-1),gt=f("span",{class:"meta"},"电脑B",-1),yt=f("span",{class:"meta"},"电脑C",-1),kt=5e5,Bt=N({__name:"index",setup(W){const h=w(!1),B=E([]),o=w("1"),m=w("2"),b=w("3"),v=w(50),_=E([{title:"电脑A",steps:[{title:"开始",status:"wait"},{title:"打包",status:"wait"},{title:"计算",status:"wait"},{title:"同步",status:"wait"},{title:"结束",status:"wait"}]},{title:"电脑B",steps:[{title:"开始",status:"wait"},{title:"打包",status:"wait"},{title:"计算",status:"wait"},{title:"同步",status:"wait"},{title:"结束",status:"wait"}]},{title:"电脑C",steps:[{title:"开始",status:"wait"},{title:"打包",status:"wait"},{title:"计算",status:"wait"},{title:"同步",status:"wait"},{title:"结束",status:"wait"}]}]),c=E([{height:1,nonce:49691,award:50,txs:[],miner:"Bridge",previous:"0000000000000000000000000000000000000000000000000000000000000000",hash:"0000b61c8bb61a6faa7c46e4872623b6e4caac5a0ae3a3b416849b216d0d62f6"}]);let z="0".repeat(4);const U=w(0),g=w(0),d=w(0),q=async()=>{h.value=!0,K.info("模拟挖矿开始运行......"),await P();const s=c.length+1;try{await Promise.all([y(s).then(()=>console.error("挖矿失败.....")),H(s).then(()=>console.error("挖矿失败.....")),J(s).then(()=>console.error("挖矿失败....."))])}catch(a){console.error("挖矿过程中出现未知错误:",a)}finally{h.value=!1,K.success("模拟挖矿结束......")}},P=async()=>{_.forEach(s=>{s.steps=[{title:"开始",status:"wait"},{title:"打包",status:"wait"},{title:"计算",status:"wait"},{title:"同步",status:"wait"},{title:"结束",status:"wait"}]})},y=async s=>{let a=_[0].steps;await A(a);let u=c[c.length-1],i=await $(u,a,"Aminer");i=await l(i,o.value,a),await j(i,s,a)&&await G(a)},H=async s=>{let a=_[1].steps;await A(a);let u=c[c.length-1],i=await $(u,a,"Bminer");i=await l(i,m.value,a),await j(i,s,a)&&await G(a)},J=async s=>{let a=_[2].steps;await A(a);let u=c[c.length-1],i=await $(u,a,"Cminer");i=await l(i,b.value,a),await j(i,s,a)&&await G(a)},A=async s=>{await new Promise(a=>setTimeout(a,2e3)),s[0].status="process",await new Promise(a=>setTimeout(a,2e3)),s[0].status="finish"},$=async(s,a,u)=>{await new Promise(r=>setTimeout(r,2e3)),a[1].status="process";let{height:i,hash:k}=s,p={height:i+1,nonce:0,txs:B,hash:"",previous:k,award:v.value,miner:u};return await new Promise(r=>setTimeout(r,2e3)),a[1].status="finish",p},l=async(s,a,u)=>{await new Promise(r=>setTimeout(r,2e3)),u[2].status="process",a==="1"&&await new Promise(r=>setTimeout(r,9e3)),a==="2"&&await new Promise(r=>setTimeout(r,6e3)),a==="3"&&await new Promise(r=>setTimeout(r,3e3));const{height:i,txs:k}=s;let p=k.map(r=>`${r.fm},${r.to},${r.amt}`).join(";");for(let r=0;r<kt;r++){const L=`${i}${r}${p}`,D=tt.SHA256(L).toString();if(D.startsWith(z))return s.nonce=r,s.hash=D,await new Promise(Z=>setTimeout(Z,2e3)),u[2].status="finish",s}return null},j=async(s,a,u)=>{if(u[3].status="process",await new Promise(i=>setTimeout(i,2e3)),c.length===a)return u[3].status="error",!1;if(s!==null){c.push(s);let i=s.award;s.miner==="Aminer"&&(U.value=U.value+i),s.miner==="Cminer"&&(g.value=g.value+i),s.miner==="Cminer"&&(d.value=d.value+i)}return u[3].status="finish",!0},G=async s=>{await new Promise(a=>setTimeout(a,2e3)),s[4].status="finish"},x=s=>{const{machine:a,gpu:u}=s;a==="a"&&(o.value=u),a==="b"&&(m.value=u),a==="c"&&(b.value=u)},I=s=>{Object.assign(B,{value:s}),console.log("此处的:",B)},F=w(),V=()=>{c.splice(0,c.length,{height:1,nonce:49691,award:50,txs:[],miner:"Bridge",previous:"0000000000000000000000000000000000000000000000000000000000000000",hash:"0000b61c8bb61a6faa7c46e4872623b6e4caac5a0ae3a3b416849b216d0d62f6"}),F.value.reset(),P()};return(s,a)=>{const u=n("a-col"),i=n("a-row"),k=n("a-button"),p=n("a-list-item-meta"),r=n("a-list-item"),L=n("a-list"),D=n("a-card");return C(),X("div",dt,[t(i,{justify:"space-between",style:{"margin-top":"25px"}},{default:e(()=>[t(u,{span:9},{default:e(()=>[t(rt,{class:"x-data",ref_key:"poolCfg",ref:F,onFetchGpu:x,onFetchTx:I},null,512)]),_:1}),t(u,{span:15},{default:e(()=>[t(mt,{items:_},null,8,["items"])]),_:1})]),_:1}),t(D,{style:{display:"flex","flex-direction":"column","margin-top":"10px"}},{title:e(()=>[_t]),extra:e(()=>[f("span",ft,"AWallet: "+O(U.value)+" Bells",1),f("span",vt,"BWallet: "+O(g.value)+" Bells",1),f("span",wt,"CWallet: "+O(d.value)+" Bells",1),t(k,{plain:"",onClick:q,loading:h.value,danger:""},{default:e(()=>[R("挖矿")]),_:1},8,["loading"]),bt,t(k,{plain:"",onClick:V},{default:e(()=>[R("重置")]),_:1})]),default:e(()=>[t(L,{class:"list"},{default:e(()=>[t(r,null,{default:e(()=>[t(p,null,{avatar:e(()=>[ht]),_:1}),t(M,{blocks:c,ref:"aBlockChain"},null,8,["blocks"])]),_:1}),t(r,null,{default:e(()=>[t(p,null,{avatar:e(()=>[gt]),_:1}),t(M,{blocks:c,ref:"bBlockChain"},null,8,["blocks"])]),_:1}),t(r,null,{default:e(()=>[t(p,null,{avatar:e(()=>[yt]),_:1}),t(M,{blocks:c,ref:"cBlockChain"},null,8,["blocks"])]),_:1})]),_:1})]),_:1})])}}});export{Bt as default};
